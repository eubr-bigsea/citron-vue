<div>
    <div>
        <div class="container-fluid">
            <div class="row small-padding">
                    <div id="appx" class="not-selectable">
                        <div class="panel operation panel-primary panel-inverse" ref="toolbox" id="toolbox">
                            <div class="panel-heading">
                                {{title}}
                            </div>
                            <div class="panel-content">
                                <div style="padding: 5px">
                                    <label>Search:</label>
                                    <input class="form-control" v-model="filterOp" v-on:keyup="filterOperations"
                                        placeholder="Informe at least 3 letters to filter"/>
                                </div>
                                <div id="menu-operations" style="height: calc(100vh - 204px); position: relative; overflow:hidden; padding-right:10px">
                                    <ul class="nav nav-list">
                                        <li class="drop-menu-item-2" v-for="group in groupedOperations">
                                            <a v-on:click="toggle"><span class="fa-caret-right fa"></span> {{ group[0] }}</a>
                                            <ul class="nav nav-list tree" :class="filtered ? 'slide-down': 'slide-up'">
                                                <div v-for="subgroup in group[1]">
                                                    <div v-if="subgroup[0].split('#')[1].length">
                                                        <ul class="nav nav-list">
                                                            <li class="drop-menu-item-3">
                                                                <a v-on:click="toggle"><span class="fa-caret-right fa"></span> {{ subgroup[0].split('#')[1] }} </a>
                                                                <ul class="nav nav-list tree" :class="filtered ? 'slide-down': 'slide-up'">
                                                                    <span v-for="op in subgroup[1]" :key="op.id">
                                                                        <toolbox-component :operation="op" />
                                                                    </span>
                                                                </ul>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    <div v-else>
                                                        <span v-for="op in subgroup[1]">
                                                            <toolbox-component :operation="op" />
                                                        </span>
                                                    </div>
                                                </div>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-primary panel-inverse" id="workflow" ref="workflow">
                            <div class="panel-content">
                                <diagram-component form-container="properties-form"></diagram-component>
                            </div>
                        </div>
                        <div class="panel panel-inverse panel-primary lemonade-properties" ref="properties" id="properties">
                            <div class="panel-heading">
                                Properties
                            </div>
                            <div class="panel-block" id="panel-properties">
                                <div class="property-description">
                                    <p><strong>{{task.operation.name}}  ({{task.id}})</strong></p>
                                    {{task.operation.description}}
                                </div>
                                <div id="properties-form" class="container" v-if="task">
                                    <div>
                                        <p><strong>Task name (optional)</strong></p>
                                        <input type="text" maxlength="50" v-model="task.name" class="form-control"/>
                                    </div>
                                    <div>
                                        <fieldset v-for="form in forms">
                                            <legend>{{form.name}}</legend>
                                            <div v-if="!form.fields.length">
                                                No parameters to configure.
                                            </div>
                                            <div v-for="field in form.fields">
                                                <keep-alive>
                                                    <component :is="field.suggested_widget + '-component'" :field="field" 
                                                        :value="getValue(field.name)" 
                                                        :suggestions="getSuggestions(task.id)" :context="context">
                                                    </component>
                                                </keep-alive>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-inverse panel-primary"  id="deploy" ref="deploy">
                            <div class="panel-heading">
                                Deploy configuration
                            </div>
                            <div class="panel-content" style="padding: 5px 5px 10px 5px" v-if="showDeploy">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-12">
                                            Please, complete the required information for the deployment of the workflow:
                                        </div>
                                        <div class="col-md-6">
                                            <label>Name:</label>
                                            <input type="text" class="form-control" required v-model="workflow.deploy.name" maxlength="50"/>
                                        </div>
                                        <div class="col-md-6">
                                            <label>Authorization token:</label>
                                            <input type="text" class="form-control" required v-model="workflow.deploy.token" maxlength="20"/>
                                        </div>
                                        <div class="col-md-12">
                                            <label>Description:</label>
                                            <textarea class="form-control" v-model="workflow.deploy.description"></textarea>
                                        </div>
                                        <div class="col-md-2">
                                            <label>CPUs:</label>
                                            <input type="number" class="form-control" required min="1" v-model="workflow.deploy.cpus" maxlength="4"/>
                                        </div>
                                        <div class="col-md-3">
                                            <label>Memory (in GB):</label>
                                            <input type="number" class="form-control" required min="0.5" step="0.5" v-model="workflow.deploy.memory" maxlength="8"/>
                                        </div>
                                        <div class="col-md-3">
                                            <label>Resp. time (in sec.):</label>
                                            <input type="number" class="form-control" required min="1" v-model="workflow.deploy.responseTime" maxlength="8"/>
                                        </div>
                                        
                                        <div class="col-md-12">
                                            <br/>
                                            <label>Select how inputs will be deployed</label>
                                            <table class="table table-bordered table-condensed">
                                                <!--
                                                <thead>
                                                    <tr>
                                                        <th class="col-md-2 text-center">Operation</th>
                                                        <th class="col-md-4 text-center">Mode</th>
                                                        <th class="col-md-4 text-center">Input name</th>
                                                        <th class="col-md-2 text-center">Action</th>
                                                    </tr>
                                                </thead>
                                                -->
                                                <tbody>
                                                <tr v-for="ds in dataSources" @mouseover="selectTaskInDeploy(ds, true)" @mouseout="selectTaskInDeploy(ds, false)">
                                                    <td class="text-center">
                                                        <small>{{ds.operation.name}} <br/>
                                                        <em v-if="ds.forms.comment.value">{{ds.forms                .comment.value}}</em></small>
                                                    </td>
                                                    <td>
                                                        <select class="form-control">
                                                        <option value=""> Single record</option>
                                                        <option value=""> Batch (records)</option>
                                                        </select>
                                                    </td>
                                                    <td><input class="form-control"/></td>
                                                    <td>
                                                        <select class="form-control">
                                                            <option>Keep intact</option>
                                                            <option>Discard</option>
                                                            <option>Use as input for service</option>
                                                        </select>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                         <div class="col-md-12">
                                            <br/>
                                            <label>Select how outputs will be deployed</label>
                                            <table class="table table-bordered table-condensed">
                                                <!--
                                                <thead>
                                                    <tr>
                                                        <th class="col-md-2 text-center">Operation</th>
                                                        <th class="col-md-4 text-center">Output name</th>
                                                        <th class="col-md-2 text-center">Action</th>
                                                    </tr>
                                                </thead>                
                                                -->
                                                <tbody>
                                                <tr v-for="ds in outputs" @mouseover="selectTaskInDeploy(ds, true)" @mouseout="selectTaskInDeploy(ds, false)">
                                                    <td class="text-center">
                                                        <small>{{ds.operation.name}} <br/>
                                                        <em v-if="ds.forms.comment.value">{{ds.forms.comment.value}}</em></small>
                                                    </td>
                                                    <td><input class="form-control"/></td>
                                                    <td>
                                                        <select class="form-control">
                                                            <option>Keep intact</option>
                                                            <option>Discard</option>
                                                            <option>Use as input for service</option>
                                                        </select>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="col-md-12">
                                            <button class="btn btn-success" xclick="execute"><span class="fa fa-cloud-upload"></span> Confirm</button>
                                            <button class="btn btn-danger" @click="cancelDeploy">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
        </div>
        <div class="row hide">
            <div class="col-md-12">
                <div style="text-align: left">
                    <small><pre><code class="python"></code></pre></small>
                </div>
                <textarea class="form-control" style="font-size:8pt" rows="10" id="save-area"></textarea>
            </div>
        </div>
    </div>
    <div v-if="errors.length > 0">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h1>{{errors}}</h1>
                </div>
            </div>
        </div>
    </div>
  
